import { PositionMatrix } from "Meta/Util.types";

export class MeshBuilder {
  textureAtlasImageWidth = 16;
  textureAtlasImageHeight = 16;
  textureAtlasTileVertical = 256;
  textureAtlasTileHorizontal = 256;
  textureAtlasWidth =
    this.textureAtlasImageWidth * this.textureAtlasTileHorizontal;
  textureAtlasHeight =
    this.textureAtlasImageHeight * this.textureAtlasTileVertical;

  getUVS(imageRow: number, imageCol: number): number[] {
    const percentFromBottm =
      ((this.textureAtlasTileVertical - imageRow) *
        this.textureAtlasImageHeight) /
      this.textureAtlasHeight;
    const percentTop =
      percentFromBottm + this.textureAtlasImageHeight / this.textureAtlasHeight;
    const percentFromLeft =
      ((imageCol - 1) * this.textureAtlasImageWidth) / this.textureAtlasWidth;
    const percentLeft =
      percentFromLeft + this.textureAtlasImageWidth / this.textureAtlasWidth;

    return [percentFromBottm, percentFromLeft, percentTop, percentLeft];
  }

  getNextAnimationBoxFaceUVs(
    uvs: number[],
    face: "top" | "bottom" | "north" | "west" | "south" | "east",
    blockID: number
  ) {
    let perc;
    let bottomStart;
    let leftStart;
    let bottomEnd;
    let leftEnd;

    switch (face) {
      case "top":
        perc = this.getUVS(1, Math.floor(Math.random() * 3) + 1);
        bottomStart = perc[0];
        leftStart = perc[1];
        bottomEnd = perc[2];
        leftEnd = perc[3];

        uvs.push(
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart,
          //3
          leftEnd,
          bottomEnd,
          //4
          leftStart,
          bottomEnd,
          //5
          leftStart,
          bottomStart,
          //6
          leftEnd,
          bottomEnd
        );

        break;

      case "bottom":
        perc = this.getUVS(1, Math.floor(Math.random() * 3) + 1);
        bottomStart = perc[0];
        leftStart = perc[1];
        bottomEnd = perc[2];
        leftEnd = perc[3];

        uvs.push(
          //1
          leftStart,
          bottomStart,
          //2
          leftStart,
          bottomEnd,
          //3
          leftEnd,
          bottomStart,
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart,
          //3
          leftEnd,
          bottomEnd
        );
        break;

      case "north":
        perc = this.getUVS(1, Math.floor(Math.random() * 3) + 1);
        bottomStart = perc[0];
        leftStart = perc[1];
        bottomEnd = perc[2];
        leftEnd = perc[3];

        uvs.push(
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart,
          //3
          leftEnd,
          bottomEnd,
          //3
          leftEnd,
          bottomEnd,
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart
        );
        break;

      case "east":
        perc = this.getUVS(1, Math.floor(Math.random() * 3) + 1);
        bottomStart = perc[0];
        leftStart = perc[1];
        bottomEnd = perc[2];
        leftEnd = perc[3];

        uvs.push(
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart,
          //3
          leftEnd,
          bottomEnd,
          //3
          leftEnd,
          bottomEnd,
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart
        );
        break;

      case "south":
        perc = this.getUVS(1, Math.floor(Math.random() * 3) + 1);
        bottomStart = perc[0];
        leftStart = perc[1];
        bottomEnd = perc[2];
        leftEnd = perc[3];

        uvs.push(
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart,
          //3
          leftEnd,
          bottomEnd,
          //3
          leftEnd,
          bottomEnd,
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart
        );
        break;

      case "west":
        perc = this.getUVS(1, Math.floor(Math.random() * 3) + 1);
        bottomStart = perc[0];
        leftStart = perc[1];
        bottomEnd = perc[2];
        leftEnd = perc[3];

        uvs.push(
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart,
          //3
          leftEnd,
          bottomEnd,
          //3
          leftEnd,
          bottomEnd,
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart
        );
        break;
    }
  }

  getBoxFace(
    postions: number[],
    indices: number[],
    normals: number[],
    colors: number[],
    uvs: number[],
    face: "top" | "bottom" | "north" | "west" | "south" | "east",
    position: PositionMatrix,
    startingIndices: number,
    width: number = 1,
    depth: number = 1,
    height: number = 1
  ) {
    let numIndices = 0;
    let perc;
    let bottomStart;
    let leftStart;
    let bottomEnd;
    let leftEnd;

    switch (face) {
      case "top":
        postions.push(0, 1.0, 0, 1, 1.0, 0, 1, 1.0, 1, 0, 1.0, 0);
           postions.push(
          
          //1
          position.x + width,
          position.y + height,
          position.z + depth,
          //2
          position.x + 0,
          position.y + height,
          position.z + depth,
          
          position.x + width,
          position.y + height,
          position.z + 0, 

        position.x + 0,
          position.y + height,
          position.z + 0,
          /*     
          position.x + width,
          position.y + height,
          position.z + 0, 
          //6
          position.x + 0,
          position.y + height,
          position.z + depth
        ); */
        indices.push(
          startingIndices,
          startingIndices + 1,
          startingIndices + 2,
          startingIndices + 3,
          startingIndices + 4,
          startingIndices + 5
        );
        numIndices = 6;
        normals.push(0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1);

        perc = this.getUVS(1, Math.floor(Math.random() * 3) + 1);
        bottomStart = perc[0];
        leftStart = perc[1];
        bottomEnd = perc[2];
        leftEnd = perc[3];

        uvs.push(
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart,
          //3
          leftEnd,
          bottomEnd,
          //4
          leftStart,
          bottomEnd,
          //5
          leftStart,
          bottomStart,
          //6
          leftEnd,
          bottomEnd
        );

        //   this._getLightLevelColors(16, 1, colors);

        break;

      case "bottom":
        postions.push(
          //1
          position.x + 0,
          position.y + 0,
          position.z + 0,
          //2
          position.x + width,
          position.y + 0,
          position.z + 0,
          //3
          position.x + 0,
          position.y + 0,
          position.z + depth,
          //4
          position.x + width,
          position.y + 0,
          position.z + depth,
          //5
          position.x + 0,
          position.y + 0,
          position.z + depth,
          //6
          position.x + width,
          position.y + 0,
          position.z + 0
        );
        indices.push(
          startingIndices + 5,
          startingIndices + 4,
          startingIndices + 3,
          startingIndices + 2,
          startingIndices + 1,
          startingIndices
        );
        numIndices = 6;
        normals.push(
          0,
          0,
          -1,
          0,
          0,
          -1,
          0,
          0,
          -1,
          0,
          0,
          -1,
          0,
          0,
          -1,
          0,
          0,
          -1
        );

        perc = this.getUVS(1, Math.floor(Math.random() * 3) + 1);
        bottomStart = perc[0];
        leftStart = perc[1];
        bottomEnd = perc[2];
        leftEnd = perc[3];

        uvs.push(
          //1
          leftStart,
          bottomStart,
          //2
          leftStart,
          bottomEnd,
          //3
          leftEnd,
          bottomStart,
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart,
          //3
          leftEnd,
          bottomEnd
        );
        //   this._getLightLevelColors(Math.floor(Math.random() * 16) + 1, 1, colors);
        break;

      case "north":
        postions.push(
          //1
          position.x + width,
          position.y + 0,
          position.z + 0,
          //2
          position.x + width,
          position.y + height,
          position.z + 0,
          //3
          position.x + 0,
          position.y + 0,
          position.z + 0,
          //4
          position.x + 0,
          position.y + 0,
          position.z + 0,
          //5
          position.x + 0,
          position.y + height,
          position.z + 0,
          //6
          position.x + width,
          position.y + height,
          position.z + 0
        );
        indices.push(
          startingIndices,
          startingIndices + 1,
          startingIndices + 2,
          startingIndices + 5,
          startingIndices + 4,
          startingIndices + 3
        );
        numIndices = 6;
        normals.push(0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1);

        perc = this.getUVS(1, Math.floor(Math.random() * 3) + 1);
        bottomStart = perc[0];
        leftStart = perc[1];
        bottomEnd = perc[2];
        leftEnd = perc[3];

        uvs.push(
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart,
          //3
          leftEnd,
          bottomEnd,
          //3
          leftEnd,
          bottomEnd,
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart
        );
        //  this._getLightLevelColors(Math.floor(Math.random() * 16) + 1, 1, colors);
        break;

      case "east":
        postions.push(
          //1
          position.x + 0,
          position.y + 0,
          position.z + depth,
          //2
          position.x + 0,
          position.y + height,
          position.z + depth,
          //3
          position.x + 0,
          position.y + 0,
          position.z + 0,
          //4
          position.x + 0,
          position.y + 0,
          position.z + 0,
          //5
          position.x + 0,
          position.y + height,
          position.z + 0,
          //6
          position.x + 0,
          position.y + height,
          position.z + depth
        );
        indices.push(
          startingIndices + 2,
          startingIndices + 1,
          startingIndices,
          startingIndices + 3,
          startingIndices + 4,
          startingIndices + 5
        );
        numIndices = 6;
        normals.push(0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1);

        perc = this.getUVS(1, Math.floor(Math.random() * 3) + 1);
        bottomStart = perc[0];
        leftStart = perc[1];
        bottomEnd = perc[2];
        leftEnd = perc[3];

        uvs.push(
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart,
          //3
          leftEnd,
          bottomEnd,
          //3
          leftEnd,
          bottomEnd,
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart
        );
        //     this._getLightLevelColors(Math.floor(Math.random() * 16) + 1, 1, colors);
        break;

      case "south":
        postions.push(
          //1
          position.x + width,
          position.y + 0,
          position.z + depth,
          //2
          position.x + width,
          position.y + height,
          position.z + depth,
          //3
          position.x + 0,
          position.y + 0,
          position.z + depth,
          //4
          position.x + 0,
          position.y + 0,
          position.z + depth,
          //5
          position.x + 0,
          position.y + height,
          position.z + depth,
          //6
          position.x + width,
          position.y + height,
          position.z + depth
        );
        indices.push(
          startingIndices + 2,
          startingIndices + 1,
          startingIndices,
          startingIndices + 3,
          startingIndices + 4,
          startingIndices + 5
        );
        numIndices = 6;
        normals.push(0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1);
        perc = this.getUVS(1, Math.floor(Math.random() * 3) + 1);
        bottomStart = perc[0];
        leftStart = perc[1];
        bottomEnd = perc[2];
        leftEnd = perc[3];

        uvs.push(
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart,
          //3
          leftEnd,
          bottomEnd,

          //3
          leftEnd,
          bottomEnd,
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart
        );
        //   this._getLightLevelColors(Math.floor(Math.random() * 16) + 1, 1, colors);
        break;

      case "west":
        postions.push(
          //1
          position.x + width,
          position.y + 0,
          position.z + depth,
          //2
          position.x + width,
          position.y + height,
          position.z + depth,
          //3
          position.x + width,
          position.y + 0,
          position.z + 0,
          //4
          position.x + width,
          position.y + 0,
          position.z + 0,
          //5
          position.x + width,
          position.y + height,
          position.z + 0,
          //6
          position.x + width,
          position.y + height,
          position.z + depth
        );
        indices.push(
          startingIndices,
          startingIndices + 1,
          startingIndices + 2,
          startingIndices + 5,
          startingIndices + 4,
          startingIndices + 3
        );
        numIndices = 6;
        normals.push(0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1);
        perc = this.getUVS(1, Math.floor(Math.random() * 3) + 1);
        bottomStart = perc[0];
        leftStart = perc[1];
        bottomEnd = perc[2];
        leftEnd = perc[3];

        uvs.push(
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart,
          //3
          leftEnd,
          bottomEnd,
          //3
          leftEnd,
          bottomEnd,
          //1
          leftStart,
          bottomEnd,
          //2
          leftStart,
          bottomStart
        );
        // this._getLightLevelColors(Math.floor(Math.random() * 16) + 1, 1, colors);
        break;
    }
    return startingIndices + numIndices;
  }

  _getLightLevelColors(level: number, color: number, colors: number[]) {
    const lightMulti = level / 16;

    colors.push(
      //1
      1 * lightMulti,
      1 * lightMulti,
      1 * lightMulti,
      1,
      //2
      1 * lightMulti,
      1 * lightMulti,
      1 * lightMulti,
      1,
      //3
      1 * lightMulti,
      1 * lightMulti,
      1 * lightMulti,
      1,
      //4
      1 * lightMulti,
      1 * lightMulti,
      1 * lightMulti,
      1,
      //5
      1 * lightMulti,
      1 * lightMulti,
      1 * lightMulti,
      1,
      //6
      1 * lightMulti,
      1 * lightMulti,
      1 * lightMulti,
      1
    );
  }
}
